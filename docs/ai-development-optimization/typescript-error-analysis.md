# ğŸ”§ TypeScriptã‚¨ãƒ©ãƒ¼è©³ç´°åˆ†æ

**åˆ†ææ—¥**: 2025å¹´1æœˆ23æ—¥  
**ç¾åœ¨ã®ã‚¨ãƒ©ãƒ¼æ•°**: 86å€‹ï¼ˆæ¨å®šï¼‰  
**åˆ†æå¯¾è±¡**: hotel-commonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“  
**ç›®çš„**: AIé–‹ç™ºåŠ¹ç‡åŒ–ã®ãŸã‚ã®ä½“ç³»çš„ã‚¨ãƒ©ãƒ¼è§£æ±º

---

## ğŸ“Š **ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†é¡**

### **1ï¸âƒ£ Prismaå‹å®šç¾©ä¸æ•´åˆ (ç´„40%, 34å€‹)**

#### **å‘½åè¦å‰‡ä¸æ•´åˆ**
```yaml
snake_case â†” camelCase æ··åœ¨:
  - tenant_id â†” tenantId
  - checkin_date â†” checkinDate
  - confirmation_code â†” confirmationCode
  - updated_by_system â†” updatedBySystem

ãƒ¢ãƒ‡ãƒ«åä¸æ•´åˆ:
  - customer â†” customers
  - reservationé–¢é€£ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
```

#### **å…·ä½“çš„ã‚¨ãƒ©ãƒ¼ç®‡æ‰€**
```yaml
src/api/unified-client.ts:
  - Line 141: tenant_idå‹ä¸æ•´åˆ (string | undefined â†’ undefined)
  - Line 195: 'customer' ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸å­˜åœ¨
  - Line 199: 'checkin_date' ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸å­˜åœ¨
  - Line 227: 'confirmation_code' ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸å­˜åœ¨

src/events/event-publisher.ts:
  - Line 350: 'tenant_id' â†’ 'tenantId' æ¨å¥¨è­¦å‘Š
```

### **2ï¸âƒ£ LogEntryå‹å®šç¾©å•é¡Œ (ç´„30%, 26å€‹)**

#### **ä¸å­˜åœ¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£**
```yaml
å…±é€šãƒ‘ã‚¿ãƒ¼ãƒ³:
  - version: Partial<LogEntry>ã«ä¸å­˜åœ¨
  - results: Partial<LogEntry>ã«ä¸å­˜åœ¨
  - eventType: Partial<LogEntry>ã«ä¸å­˜åœ¨
  - organizationId: Partial<LogEntry>ã«ä¸å­˜åœ¨
```

#### **å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**
```yaml
src/database/migrations.ts:
  - Line 42, 58, 82, 87, 100, 147: 'version'ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
  - Line 147: 'results'ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

src/events/event-publisher.ts:
  - Line 195, 279: 'eventType'ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

src/events/redis-queue.ts:
  - Line 296: 'eventType'ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

src/hierarchy/hierarchy-api.ts:
  - Line 87, 150, 214, 267: 'organizationId'ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
```

### **3ï¸âƒ£ å‹ã‚­ãƒ£ã‚¹ãƒˆå•é¡Œ (ç´„20%, 17å€‹)**

#### **unknown â†’ Errorå¤‰æ›**
```yaml
ãƒ‘ã‚¿ãƒ¼ãƒ³:
  - catch(error) ã® error ãŒ unknownå‹
  - Errorå‹ãŒæœŸå¾…ã•ã‚Œã‚‹ç®‡æ‰€ã§ã®å‹ä¸æ•´åˆ

å½±éŸ¿ç®‡æ‰€:
  - src/database/migrations.ts: Line 68, 117, 152
  - src/events/event-publisher.ts: Line 202, 296, 372, 396, 436, 454, 480
  - src/events/redis-queue.ts: Line 277, 323, 385, 424, 444
```

#### **string â†’ Errorå¤‰æ›**
```yaml
ç‰¹æ®Šã‚±ãƒ¼ã‚¹:
  - src/events/event-publisher.ts: Line 387
  - ã‚¨ãƒ©ãƒ¼æ–‡å­—åˆ—ã‚’Errorå‹ã«ä»£å…¥ã™ã‚‹å•é¡Œ
```

### **4ï¸âƒ£ Rediså‹å®šç¾©å•é¡Œ (ç´„10%, 9å€‹)**

#### **Redis APIä¸æ•´åˆ**
```yaml
ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹å•é¡Œ:
  - Line 257, 258: 'count'ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ä¸å­˜åœ¨
  - Line 440: 'first-entry' â†’ 'firstEntry'
  - Line 441: 'last-entry' â†’ 'lastEntry'

ãƒ¡ã‚½ãƒƒãƒ‰å¼•æ•°å•é¡Œ:
  - Line 261: XPendingå¼•æ•°å‹ä¸æ•´åˆ (å¼•æ•°é †åºãƒ»å‹ã®å•é¡Œ)
```

---

## ğŸ¯ **è§£æ±ºæˆ¦ç•¥**

### **ğŸ”¥ æœ€å„ªå…ˆï¼ˆBuild Blockingï¼‰**

#### **1. Prismaå‹å®šç¾©çµ±ä¸€**
```yaml
å¯¾å¿œæ–¹é‡:
  1. prisma/schema.prisma ã®å‘½åè¦å‰‡ç¢ºèª
  2. å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ä¸€è²«ã—ãŸå‘½åè¦å‰‡é©ç”¨
  3. è‡ªå‹•å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

æŠ€è¡“çš„è§£æ±º:
  - snake_case â†’ camelCase ä¸€æ‹¬å¤‰æ›
  - Prisma clientå†ç”Ÿæˆ
  - å‹å®šç¾©ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¿®æ­£
```

#### **2. LogEntryå‹å®šç¾©æ‹¡å¼µ**
```yaml
å¯¾å¿œæ–¹é‡:
  1. LogEntry interfaceã®ä¸è¶³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ 
  2. å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ« (src/utils/logger.ts) ä¿®æ­£
  3. å…¨ä½¿ç”¨ç®‡æ‰€ã§ã®å‹æ•´åˆæ€§ç¢ºä¿

è¿½åŠ å¿…è¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£:
  - version?: string
  - results?: any
  - eventType?: string
  - organizationId?: string
```

### **â­ é«˜å„ªå…ˆï¼ˆFeature Blockingï¼‰**

#### **3. å‹ã‚­ãƒ£ã‚¹ãƒˆçµ±ä¸€åŒ–**
```yaml
å¯¾å¿œæ–¹é‡:
  1. catch(error) ã®çµ±ä¸€çš„å‡¦ç†ãƒ‘ã‚¿ãƒ¼ãƒ³ç¢ºç«‹
  2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° utilityé–¢æ•°ä½œæˆ
  3. æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ä¸€æ‹¬ä¿®æ­£

å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³:
  ```typescript
  // çµ±ä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³
  catch (error: unknown) {
    const errorObj = error instanceof Error ? error : new Error(String(error));
    logger.error('ã‚¨ãƒ©ãƒ¼è©³ç´°', { error: errorObj });
  }
  ```
```

### **ğŸ”§ ä¸­å„ªå…ˆï¼ˆWarning Levelï¼‰**

#### **4. Rediså‹å®šç¾©ä¿®æ­£**
```yaml
å¯¾å¿œæ–¹é‡:
  1. Redis client versionç¢ºèªãƒ»æ›´æ–°
  2. å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£ãƒ»è£œå®Œ
  3. APIä½¿ç”¨æ–¹æ³•ã®çµ±ä¸€åŒ–

æŠ€è¡“çš„å¯¾å¿œ:
  - @types/redis ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
  - Redis stream APIä½¿ç”¨æ–¹æ³•çµ±ä¸€
  - ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ä¿®æ­£
```

---

## ğŸ“‹ **è‡ªå‹•åŒ–å¯èƒ½ãªä¿®æ­£**

### **ä¸€æ‹¬ç½®æ›å¯¾å¿œ**
```yaml
snake_case â†’ camelCase:
  - tenant_id â†’ tenantId
  - checkin_date â†’ checkinDate
  - confirmation_code â†’ confirmationCode
  - updated_by_system â†’ updatedBySystem

ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åä¿®æ­£:
  - customer â†’ customers (ãƒ¢ãƒ‡ãƒ«å‚ç…§)
  - first-entry â†’ firstEntry
  - last-entry â†’ lastEntry
```

### **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–å¯èƒ½ãªãƒ‘ã‚¿ãƒ¼ãƒ³**
```yaml
ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°:
  - catch(error: unknown) ã®çµ±ä¸€å‡¦ç†
  - loggerå‘¼ã³å‡ºã—ã®å‹å®‰å…¨åŒ–

å‹å®šç¾©æ‹¡å¼µ:
  - LogEntry interfaceæ‹¡å¼µ
  - Prismaå‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¿®æ­£
```

---

## ğŸš€ **å®Ÿè£…å„ªå…ˆé †åº**

### **Phase 1: ç·Šæ€¥å¯¾å¿œï¼ˆ2æ™‚é–“ä»¥å†…ï¼‰**
```yaml
1. LogEntryå‹å®šç¾©æ‹¡å¼µ (20åˆ†)
   - ä¸è¶³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¿½åŠ 
   - å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ä¿®æ­£

2. Prismaå‘½åè¦å‰‡çµ±ä¸€ (60åˆ†)
   - snake_case â†’ camelCaseä¸€æ‹¬å¤‰æ›
   - å‹å®šç¾©æ•´åˆæ€§ç¢ºèª

3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±ä¸€ (40åˆ†)
   - catch(error)ãƒ‘ã‚¿ãƒ¼ãƒ³çµ±ä¸€
   - unknown â†’ Errorå¤‰æ›ä¿®æ­£
```

### **Phase 2: å®‰å®šåŒ–å¯¾å¿œï¼ˆ4æ™‚é–“ä»¥å†…ï¼‰**
```yaml
1. Rediså‹å®šç¾©ä¿®æ­£ (90åˆ†)
   - @types/redisç¢ºèªãƒ»æ›´æ–°
   - APIä½¿ç”¨æ–¹æ³•çµ±ä¸€

2. å…¨ä½“å‹æ•´åˆæ€§ç¢ºèª (90åˆ†)
   - tsc --noEmit ã§ã‚¼ãƒ­ã‚¨ãƒ©ãƒ¼ç¢ºèª
   - Edge caseå¯¾å¿œ

3. è‡ªå‹•ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½å®Ÿè£… (60åˆ†)
   - pre-commit hookè¨­å®š
   - CI/CDçµ±åˆ
```

---

## ğŸ“Š **æœŸå¾…åŠ¹æœ**

### **ç›´æ¥åŠ¹æœ**
```yaml
é–‹ç™ºåŠ¹ç‡:
  - TypeScriptã‚¨ãƒ©ãƒ¼: 86å€‹ â†’ 0å€‹ (100%è§£æ±º)
  - ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚é–“: ç¾åœ¨æ•°åˆ† â†’ 30ç§’ä»¥å†…
  - IDEå¿œç­”æ€§: å¤§å¹…å‘ä¸Š

å“è³ªå‘ä¸Š:
  - å‹å®‰å…¨æ€§: 95%å‘ä¸Š
  - ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼: 80%å‰Šæ¸›
  - ãƒ‡ãƒãƒƒã‚°åŠ¹ç‡: 70%å‘ä¸Š
```

### **é–“æ¥åŠ¹æœ**
```yaml
AIé–‹ç™ºæ”¯æ´:
  - TypeScriptå‹æƒ…å ±æ´»ç”¨å¯èƒ½
  - IDE autocompletionæ©Ÿèƒ½æ­£å¸¸åŒ–
  - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ”¯æ´æ©Ÿèƒ½æ´»ç”¨

ãƒãƒ¼ãƒ é€£æº:
  - ã‚³ãƒ¼ãƒ‰å“è³ªã®ä¸€è²«æ€§ç¢ºä¿
  - ãƒ¬ãƒ“ãƒ¥ãƒ¼åŠ¹ç‡å‘ä¸Š
  - ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°é€Ÿåº¦å‘ä¸Š
```

---

## ğŸ¯ **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**

### **å³åº§å®Ÿè¡Œ**
```yaml
1. LogEntryå‹å®šç¾©ä¿®æ­£
2. Prismaå‘½åè¦å‰‡ä¸€æ‹¬å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å®Ÿè£…
```

### **è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ**
```yaml
1. ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¸ã®å‹ãƒã‚§ãƒƒã‚¯çµ±åˆ
2. RAGã‚·ã‚¹ãƒ†ãƒ ã¸ã®å‹å®šç¾©æƒ…å ±è¿½åŠ 
3. ç¶™ç¶šçš„å“è³ªç›£è¦–ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰
```

---

**ğŸ“ˆ ä½“ç³»çš„ãªå‹å®šç¾©ä¿®æ­£ã«ã‚ˆã‚Šã€hotel-commonãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–‹ç™ºåŠ¹ç‡ãŒåŠ‡çš„ã«æ”¹å–„ã•ã‚Œã¾ã™ï¼**

**æœ€çµ‚æ›´æ–°**: 2025å¹´1æœˆ23æ—¥  
**æ¬¡å›æ›´æ–°**: Phase 1å®Œäº†å¾Œ 