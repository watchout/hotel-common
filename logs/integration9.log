PostgreSQLæ¥ç¶šç¢ºèªå®Œäº†
[32m[2025-09-08T22:52:56.062Z] INFO[0m [hotel-common]: ğŸ¯ hotel-memberéšå±¤æ¨©é™ç®¡ç†çµ±åˆåˆæœŸåŒ–ä¸­...
[32m[2025-09-08T22:52:56.063Z] INFO[0m [hotel-common]: âœ… hotel-memberéšå±¤æ¨©é™ç®¡ç†çµ±åˆåˆæœŸåŒ–å®Œäº†
[32m[2025-09-08T22:52:56.063Z] INFO[0m [hotel-common]: 
ğŸ¯ hotel-memberéšå±¤æ¨©é™ç®¡ç†çµ±åˆç¨¼åƒä¸­

ğŸ“Š å¯¾å¿œæ©Ÿèƒ½:
- éšå±¤JWTèªè¨¼çµ±åˆ
- é¡§å®¢ãƒ‡ãƒ¼ã‚¿éšå±¤ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- ä¼šå“¡ãƒ©ãƒ³ã‚¯ãƒ»ãƒã‚¤ãƒ³ãƒˆéšå±¤ç®¡ç†
- ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ææ¨©é™åˆ¶å¾¡
- FastAPIé€£æºã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

ğŸ”— APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:
- VERIFY_TOKEN: /api/hotel-member/hierarchy/auth/verify
- CHECK_CUSTOMER_ACCESS: /api/hotel-member/hierarchy/permissions/check-customer-access
- CHECK_MEMBERSHIP_RESTRICTIONS: /api/hotel-member/hierarchy/permissions/check-membership-restrictions
- CHECK_ANALYTICS_ACCESS: /api/hotel-member/hierarchy/permissions/check-analytics-access
- BATCH_CHECK: /api/hotel-member/hierarchy/permissions/batch-check
- GET_ACCESSIBLE_TENANTS: /api/hotel-member/hierarchy/tenants/accessible
- GET_PERMISSIONS_DETAIL: /api/hotel-member/hierarchy/user/permissions-detail
- HEALTH_CHECK: /api/hotel-member/hierarchy/health

ğŸ¯ å®Ÿè£…æˆ¦ç•¥: éƒ¨åˆ†å¯¾å¿œï¼ˆé¡§å®¢ãƒ‡ãƒ¼ã‚¿é‡ç‚¹ï¼‰
âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿æœ€å°åŒ–
ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: éšå±¤åˆ¥ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
    
hotel-memberçµ±åˆåˆæœŸåŒ–å®Œäº†

ğŸ‰ hotel-commonçµ±åˆAPIã‚µãƒ¼ãƒãƒ¼èµ·å‹•å®Œäº†ï¼

ğŸ“Š ã‚µãƒ¼ãƒãƒ¼æƒ…å ±:
- ãƒãƒ¼ãƒˆ: 3400
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: PostgreSQL (hotel_unified_db)
- ç›£è¦–å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ : 4å€‹

ğŸ”— åˆ©ç”¨å¯èƒ½ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:
- GET  /health                    - ã‚µãƒ¼ãƒãƒ¼ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- GET  /api/systems/status        - ã‚·ã‚¹ãƒ†ãƒ æ¥ç¶šçŠ¶æ³
- POST /api/systems/:name/test    - ã‚·ã‚¹ãƒ†ãƒ æ¥ç¶šãƒ†ã‚¹ãƒˆ
- GET  /api/database/test         - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ
- GET  /api/tenants              - ãƒ†ãƒŠãƒ³ãƒˆä¸€è¦§
- POST /api/auth/validate        - èªè¨¼æ¤œè¨¼
- GET  /api/stats                - ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆ
- GET  /api/v1/campaigns/health  - ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³æ©Ÿèƒ½ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- GET  /api/apps/google-play     - Google Playã‚¢ãƒ—ãƒªä¸€è¦§

ğŸ¯ æ¥ç¶šå¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ :
- ğŸª hotel-saas (http://localhost:3100)
- ğŸ¯ hotel-member-frontend (http://localhost:3200)
- ğŸ¯ hotel-member-backend (http://localhost:8080)
- ğŸ’¼ hotel-pms (http://localhost:3300)
        
2025-09-08T22:52:56.782Z GET /health
2025-09-08T22:52:56.881Z GET /api/v1/admin/operation-logs
JWTæ¤œè¨¼ã‚¨ãƒ©ãƒ¼: ReferenceError: JWT_REQUIRE_X_TENANT is not defined
    at authMiddleware (/Users/kaneko/hotel-common/dist/auth/middleware.js:187:9)
    at Layer.handle [as handle_request] (/Users/kaneko/hotel-common/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/kaneko/hotel-common/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/kaneko/hotel-common/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/kaneko/hotel-common/node_modules/express/lib/router/layer.js:95:5)
    at /Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:280:10)
    at Function.handle (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:175:3)
    at router (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:47:12)
prisma:query INSERT INTO "public"."system_event" ("id","tenant_id","event_type","source_system","target_system","entity_type","entity_id","action","event_data","created_at","status") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "public"."system_event"."id", "public"."system_event"."tenant_id", "public"."system_event"."user_id", "public"."system_event"."event_type", "public"."system_event"."source_system", "public"."system_event"."target_system", "public"."system_event"."entity_type", "public"."system_event"."entity_id", "public"."system_event"."action", "public"."system_event"."event_data", "public"."system_event"."created_at", "public"."system_event"."processed_at", "public"."system_event"."status"
2025-09-08T22:53:12.997Z GET /api/v1/admin/operation-logs
JWTæ¤œè¨¼ã‚¨ãƒ©ãƒ¼: ReferenceError: JWT_REQUIRE_X_TENANT is not defined
    at authMiddleware (/Users/kaneko/hotel-common/dist/auth/middleware.js:187:9)
    at Layer.handle [as handle_request] (/Users/kaneko/hotel-common/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/kaneko/hotel-common/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/kaneko/hotel-common/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/kaneko/hotel-common/node_modules/express/lib/router/layer.js:95:5)
    at /Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:280:10)
    at Function.handle (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:175:3)
    at router (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:47:12)
prisma:query SELECT 1
prisma:query INSERT INTO "public"."system_event" ("id","tenant_id","event_type","source_system","target_system","entity_type","entity_id","action","event_data","created_at","status") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "public"."system_event"."id", "public"."system_event"."tenant_id", "public"."system_event"."user_id", "public"."system_event"."event_type", "public"."system_event"."source_system", "public"."system_event"."target_system", "public"."system_event"."entity_type", "public"."system_event"."entity_id", "public"."system_event"."action", "public"."system_event"."event_data", "public"."system_event"."created_at", "public"."system_event"."processed_at", "public"."system_event"."status"
Performing initial health check...
ğŸ” Health check started (0/4 systems connected)
ğŸ“Š Health check completed (1/4 systems connected)
2025-09-08T22:54:03.078Z GET /api/v1/admin/operation-logs
JWTæ¤œè¨¼ã‚¨ãƒ©ãƒ¼: ReferenceError: JWT_REQUIRE_X_TENANT is not defined
    at authMiddleware (/Users/kaneko/hotel-common/dist/auth/middleware.js:187:9)
    at Layer.handle [as handle_request] (/Users/kaneko/hotel-common/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/kaneko/hotel-common/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/kaneko/hotel-common/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/kaneko/hotel-common/node_modules/express/lib/router/layer.js:95:5)
    at /Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:280:10)
    at Function.handle (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:175:3)
    at router (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:47:12)
prisma:query SELECT 1
prisma:query INSERT INTO "public"."system_event" ("id","tenant_id","event_type","source_system","target_system","entity_type","entity_id","action","event_data","created_at","status") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "public"."system_event"."id", "public"."system_event"."tenant_id", "public"."system_event"."user_id", "public"."system_event"."event_type", "public"."system_event"."source_system", "public"."system_event"."target_system", "public"."system_event"."entity_type", "public"."system_event"."entity_id", "public"."system_event"."action", "public"."system_event"."event_data", "public"."system_event"."created_at", "public"."system_event"."processed_at", "public"."system_event"."status"
2025-09-08T22:54:54.084Z GET /api/v1/admin/operation-logs
JWTæ¤œè¨¼ã‚¨ãƒ©ãƒ¼: ReferenceError: JWT_REQUIRE_X_TENANT is not defined
    at authMiddleware (/Users/kaneko/hotel-common/dist/auth/middleware.js:187:9)
    at Layer.handle [as handle_request] (/Users/kaneko/hotel-common/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/kaneko/hotel-common/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/kaneko/hotel-common/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/kaneko/hotel-common/node_modules/express/lib/router/layer.js:95:5)
    at /Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:346:12)
    at next (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:280:10)
    at Function.handle (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:175:3)
    at router (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:47:12)
prisma:query SELECT 1
prisma:query INSERT INTO "public"."system_event" ("id","tenant_id","event_type","source_system","target_system","entity_type","entity_id","action","event_data","created_at","status") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "public"."system_event"."id", "public"."system_event"."tenant_id", "public"."system_event"."user_id", "public"."system_event"."event_type", "public"."system_event"."source_system", "public"."system_event"."target_system", "public"."system_event"."entity_type", "public"."system_event"."entity_id", "public"."system_event"."action", "public"."system_event"."event_data", "public"."system_event"."created_at", "public"."system_event"."processed_at", "public"."system_event"."status"
ğŸ” Health check started (1/4 systems connected)
2025-09-08T22:55:11.493Z GET /api/v1/admin/operation-logs
JWTæ¤œè¨¼ã‚¨ãƒ©ãƒ¼: JsonWebTokenError: invalid signature
    at /Users/kaneko/hotel-common/node_modules/jsonwebtoken/verify.js:171:19
    at getSecret (/Users/kaneko/hotel-common/node_modules/jsonwebtoken/verify.js:97:14)
    at module.exports (/Users/kaneko/hotel-common/node_modules/jsonwebtoken/verify.js:101:10)
    at authMiddleware (/Users/kaneko/hotel-common/dist/auth/middleware.js:175:29)
    at Layer.handle [as handle_request] (/Users/kaneko/hotel-common/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/kaneko/hotel-common/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/kaneko/hotel-common/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/kaneko/hotel-common/node_modules/express/lib/router/layer.js:95:5)
    at /Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/kaneko/hotel-common/node_modules/express/lib/router/index.js:346:12)
prisma:query SELECT 1
prisma:query INSERT INTO "public"."system_event" ("id","tenant_id","event_type","source_system","target_system","entity_type","entity_id","action","event_data","created_at","status") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "public"."system_event"."id", "public"."system_event"."tenant_id", "public"."system_event"."user_id", "public"."system_event"."event_type", "public"."system_event"."source_system", "public"."system_event"."target_system", "public"."system_event"."entity_type", "public"."system_event"."entity_id", "public"."system_event"."action", "public"."system_event"."event_data", "public"."system_event"."created_at", "public"."system_event"."processed_at", "public"."system_event"."status"
ğŸ” Health check started (1/4 systems connected)
ğŸ” Health check started (1/4 systems connected)
