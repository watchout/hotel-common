generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model DatabaseChangeLog {
  id          Int      @id @default(autoincrement())
  changeType  String
  description String
  details     Json?
  createdBy   String?
  createdAt   DateTime @default(now())

  @@index([changeType])
  @@index([createdAt])
}

model SystemPlanRestrictions {
  id                       String             @id
  systemType               String
  businessType             String
  planType                 String
  planCategory             String
  monthlyPrice             Int
  maxDevices               Int                @default(30)
  additionalDeviceCost     Int                @default(1200)
  roomTerminalCost         Int                @default(1200)
  frontDeskCost            Int                @default(5000)
  kitchenCost              Int                @default(2000)
  barCost                  Int                @default(2000)
  housekeepingCost         Int                @default(2000)
  managerCost              Int                @default(5000)
  commonAreaCost           Int                @default(3500)
  enableAiConcierge        Boolean            @default(false)
  enableMultilingual       Boolean            @default(false)
  enableLayoutEditor       Boolean            @default(false)
  enableFacilityGuide      Boolean            @default(false)
  enableAiBusinessSupport  Boolean            @default(false)
  maxMonthlyOrders         Int                @default(1000)
  maxMonthlyAiRequests     Int                @default(0)
  maxStorageGB             Float              @default(5.0)
  multilingualUpgradePrice Int                @default(3000)
  description              String?
  createdAt                DateTime           @default(now())
  updatedAt                DateTime
  deleted_at               DateTime?
  deleted_by               String?
  is_deleted               Boolean            @default(false)
  TenantSystemPlan         TenantSystemPlan[]

  @@unique([systemType, businessType, planType, planCategory], map: "SystemPlanRestrictions_systemType_businessType_planType_planCat")
  @@index([is_deleted])
}

model Tenant {
  id                       String                     @id
  name                     String
  domain                   String?                    @unique
  planType                 String?
  status                   String                     @default("active")
  contactEmail             String?
  createdAt                DateTime                   @default(now())
  deleted_at               DateTime?
  deleted_by               String?
  features                 String[]
  is_deleted               Boolean                    @default(false)
  settings                 Json?
  TenantSystemPlan         TenantSystemPlan[]
  ai_operation_logs        ai_operation_logs[]
  auth_logs                auth_logs[]
  billing_logs             billing_logs[]
  device_rooms             device_rooms[]
  device_usage_logs        device_usage_logs[]
  pages                    pages[]
  security_logs            security_logs[]
  service_usage_statistics service_usage_statistics[]
  staff_invitations        staff_invitations[]
  staff_tenant_memberships staff_tenant_memberships[]
  tenant_services          tenant_services[]

  @@index([is_deleted])
}

model TenantSystemPlan {
  id                     String                 @id
  tenantId               String
  systemType             String
  planId                 String
  startDate              DateTime               @default(now())
  endDate                DateTime?
  isActive               Boolean                @default(true)
  monthlyPrice           Int
  createdAt              DateTime               @default(now())
  updatedAt              DateTime
  deleted_at             DateTime?
  deleted_by             String?
  is_deleted             Boolean                @default(false)
  SystemPlanRestrictions SystemPlanRestrictions @relation(fields: [planId], references: [id])
  Tenant                 Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, systemType])
  @@index([isActive])
  @@index([is_deleted])
  @@index([planId])
  @@index([systemType])
  @@index([tenantId])
}

model admin {
  id                                     String      @id
  email                                  String      @unique
  username                               String      @unique
  display_name                           String
  password_hash                          String
  admin_level                            AdminLevel
  accessible_group_ids                   String[]
  accessible_chain_ids                   String[]
  accessible_tenant_ids                  String[]
  last_login_at                          DateTime?
  login_attempts                         Int         @default(0)
  locked_until                           DateTime?
  totp_secret                            String?
  totp_enabled                           Boolean     @default(false)
  created_at                             DateTime    @default(now())
  updated_at                             DateTime
  created_by                             String?
  is_active                              Boolean     @default(true)
  deleted_at                             DateTime?
  deleted_by                             String?
  is_deleted                             Boolean     @default(false)
  admin_log                              admin_log[]
  admin_log_admin_log_approved_byToadmin admin_log[] @relation("admin_log_approved_byToadmin")

  @@index([is_deleted])
}

model admin_log {
  id                                 String    @id
  admin_id                           String
  action                             String
  target_type                        String?
  target_id                          String?
  ip_address                         String?
  user_agent                         String?
  success                            Boolean   @default(true)
  error_message                      String?
  created_at                         DateTime  @default(now())
  deleted_at                         DateTime?
  deleted_by                         String?
  is_deleted                         Boolean   @default(false)
  operation_category                 String?
  risk_level                         String?   @default("LOW")
  business_context                   Json?
  session_id                         String?
  approval_required                  Boolean?  @default(false)
  approved_by                        String?
  reason                             String?
  admin                              admin     @relation(fields: [admin_id], references: [id])
  admin_admin_log_approved_byToadmin admin?    @relation("admin_log_approved_byToadmin", fields: [approved_by], references: [id])

  @@index([action])
  @@index([admin_id])
  @@index([created_at])
  @@index([is_deleted])
  @@index([approved_by, created_at])
  @@index([operation_category, created_at])
  @@index([risk_level, created_at])
  @@index([session_id])
}

model campaign_categories {
  id                          String                        @id
  tenantId                    String
  code                        String                        @unique
  name                        String
  description                 String?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  deleted_at                  DateTime?
  deleted_by                  String?
  is_deleted                  Boolean                       @default(false)
  campaign_category_relations campaign_category_relations[]

  @@index([is_deleted])
  @@index([tenantId])
}

model campaign_category_relations {
  id                  String              @id
  campaignId          String
  categoryId          String
  createdAt           DateTime            @default(now())
  deleted_at          DateTime?
  deleted_by          String?
  is_deleted          Boolean             @default(false)
  campaigns           campaigns           @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  campaign_categories campaign_categories @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([campaignId, categoryId])
  @@index([is_deleted])
}

model campaign_items {
  id         String    @id
  campaignId String
  itemId     String
  itemType   String
  priority   Int       @default(0)
  createdAt  DateTime  @default(now())
  deleted_at DateTime?
  deleted_by String?
  is_deleted Boolean   @default(false)
  campaigns  campaigns @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([campaignId, itemId, itemType])
  @@index([is_deleted])
}

model campaign_translations {
  id           String    @id
  campaignId   String
  locale       String
  title        String
  description  String?
  imageUrl     String?
  languageCode String?
  name         String?
  deleted_at   DateTime?
  deleted_by   String?
  is_deleted   Boolean   @default(false)
  campaigns    campaigns @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([campaignId, locale])
  @@index([is_deleted])
  @@index([languageCode])
}

model campaign_usage_logs {
  id         String    @id
  campaignId String
  userId     String?
  deviceId   String?
  action     String
  createdAt  DateTime  @default(now())
  deleted_at DateTime?
  deleted_by String?
  is_deleted Boolean   @default(false)
  campaigns  campaigns @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([deviceId])
  @@index([is_deleted])
  @@index([userId])
}

model campaigns {
  id                          String                        @id
  tenantId                    String
  code                        String                        @unique
  status                      CampaignStatus                @default(DRAFT)
  displayType                 CampaignDisplayType
  startDate                   DateTime?
  endDate                     DateTime?
  priority                    Int                           @default(0)
  ctaType                     CampaignCtaType               @default(NONE)
  ctaAction                   String?
  ctaLabel                    String?
  discountType                String?
  discountValue               Decimal?                      @db.Decimal(10, 2)
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  dayRestrictions             Json?
  description                 String?
  displayPriority             Int                           @default(0)
  maxUsageCount               Int?
  name                        String
  timeRestrictions            Json?
  welcomeSettings             Json?
  deleted_at                  DateTime?
  deleted_by                  String?
  is_deleted                  Boolean                       @default(false)
  campaign_category_relations campaign_category_relations[]
  campaign_items              campaign_items[]
  campaign_translations       campaign_translations[]
  campaign_usage_logs         campaign_usage_logs[]

  @@index([is_deleted])
  @@index([startDate, endDate])
  @@index([status])
  @@index([tenantId])
}

model customers {
  id                   String         @id
  tenant_id            String
  name                 String
  email                String?
  phone                String?
  address              String?
  birth_date           DateTime?
  member_id            String?
  rank_id              String?
  total_points         Int            @default(0)
  total_stays          Int            @default(0)
  pms_updatable_fields String[]       @default(["name", "phone", "address"])
  origin_system        String         @default("hotel-member")
  synced_at            DateTime       @default(now())
  updated_by_system    String         @default("hotel-member")
  preferences          Json           @default("{}")
  created_at           DateTime       @default(now())
  updated_at           DateTime
  deleted_at           DateTime?
  deleted_by           String?
  is_deleted           Boolean        @default(false)
  reservations         reservations[]

  @@index([email])
  @@index([is_deleted])
  @@index([member_id])
  @@index([tenant_id])
}

model device_rooms {
  id                 Int                  @id @default(autoincrement())
  tenantId           String
  roomId             String
  roomName           String?
  deviceId           String?
  deviceType         String?
  placeId            String?
  status             String?              @default("active")
  ipAddress          String?
  macAddress         String?
  lastUsedAt         DateTime?
  isActive           Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  is_deleted         Boolean              @default(false)
  deleted_at         DateTime?
  deleted_by         String?
  device_access_logs device_access_logs[]
  Tenant             Tenant               @relation(fields: [tenantId], references: [id])

  @@index([deviceId])
  @@index([is_deleted])
  @@index([placeId])
  @@index([roomId])
  @@index([status])
  @@index([tenantId])
}

model device_video_caches {
  id           String    @id
  deviceId     String
  videoIds     String[]
  lastShownAt  DateTime  @default(now())
  updatedAt    DateTime
  lastViewedAt DateTime?
  userId       String?
  viewed       Boolean   @default(false)
  deleted_at   DateTime?
  deleted_by   String?
  is_deleted   Boolean   @default(false)

  @@unique([deviceId, userId])
  @@index([is_deleted])
}

model notification_templates {
  id         String    @id
  tenant_id  String
  type       String
  code       String
  subject    String?
  content    String
  variables  String[]
  is_active  Boolean   @default(true)
  created_at DateTime  @default(now())
  updated_at DateTime
  body       String
  html       Boolean   @default(false)
  locale     String
  deleted_at DateTime?
  deleted_by String?
  is_deleted Boolean   @default(false)

  @@unique([tenant_id, type, code, locale])
  @@index([is_deleted])
  @@index([tenant_id])
  @@index([type])
}

model page_histories {
  Id         String    @id
  PageId     String
  Html       String?
  Css        String?
  Content    String?
  Template   String?
  Version    Int
  CreatedAt  DateTime  @default(now())
  CreatedBy  String?
  deleted_at DateTime?
  deleted_by String?
  is_deleted Boolean   @default(false)
  pages      pages     @relation(fields: [PageId], references: [Id], onDelete: Cascade)

  @@index([PageId])
  @@index([Version])
  @@index([is_deleted])
}

model pages {
  Id             String           @id
  TenantId       String
  Slug           String
  Title          String
  Html           String?
  Css            String?
  Content        String?
  Template       String?
  IsPublished    Boolean          @default(false)
  PublishedAt    DateTime?
  Version        Int              @default(1)
  CreatedAt      DateTime         @default(now())
  UpdatedAt      DateTime
  deleted_at     DateTime?
  deleted_by     String?
  is_deleted     Boolean          @default(false)
  page_histories page_histories[]
  Tenant         Tenant           @relation(fields: [TenantId], references: [id])

  @@unique([TenantId, Slug])
  @@index([IsPublished])
  @@index([Slug])
  @@index([TenantId])
  @@index([is_deleted])
}

model reservations {
  id                  String     @id
  tenant_id           String
  customer_id         String?
  guest_name          String
  guest_phone         String?
  guest_email         String?
  checkin_date        DateTime
  checkout_date       DateTime
  adult_count         Int        @default(1)
  child_count         Int        @default(0)
  room_type           String
  room_number         String?
  total_amount        Decimal    @db.Decimal(10, 2)
  deposit_amount      Decimal    @default(0) @db.Decimal(10, 2)
  status              String     @default("PENDING")
  origin              String
  ota_id              String?
  confirmation_number String
  special_requests    String?
  internal_notes      String?
  origin_system       String     @default("hotel-pms")
  synced_at           DateTime   @default(now())
  updated_by_system   String     @default("hotel-pms")
  created_at          DateTime   @default(now())
  updated_at          DateTime
  deleted_at          DateTime?
  is_deleted          Boolean    @default(false)
  deleted_by          String?
  customers           customers? @relation(fields: [customer_id], references: [id])

  @@index([checkin_date])
  @@index([checkout_date])
  @@index([is_deleted])
  @@index([status])
  @@index([tenant_id])
}

model response_node_translations {
  id             String         @id
  nodeId         String
  locale         String
  content        String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  answer         Json?
  language       String?
  title          String?
  deleted_at     DateTime?
  deleted_by     String?
  is_deleted     Boolean        @default(false)
  response_nodes response_nodes @relation(fields: [nodeId], references: [id], onDelete: Cascade)

  @@unique([nodeId, language])
  @@unique([nodeId, locale])
  @@index([is_deleted])
}

model response_nodes {
  id                         String                       @id
  treeId                     String
  nodeType                   String
  content                    String?
  metadata                   Json?
  isRoot                     Boolean                      @default(false)
  parentId                   String?
  position                   Int                          @default(0)
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime
  answer                     Json?
  description                String?
  icon                       String?
  order                      Int                          @default(0)
  title                      String?
  type                       String?
  response_node_translations response_node_translations[]
  response_nodes             response_nodes?              @relation("response_nodesToresponse_nodes", fields: [parentId], references: [id])
  other_response_nodes       response_nodes[]             @relation("response_nodesToresponse_nodes")
  response_trees             response_trees               @relation(fields: [treeId], references: [id], onDelete: Cascade)
  response_tree_history      response_tree_history[]
  response_tree_sessions     response_tree_sessions[]

  @@index([isRoot])
  @@index([parentId])
  @@index([treeId])
}

model response_tree_history {
  id                     String                 @id
  sessionId              String
  nodeId                 String
  response               String?
  metadata               Json?
  createdAt              DateTime               @default(now())
  action                 String?
  timestamp              DateTime               @default(now())
  response_nodes         response_nodes         @relation(fields: [nodeId], references: [id])
  response_tree_sessions response_tree_sessions @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
}

model response_tree_mobile_links {
  id                     String                 @id
  sessionId              String
  code                   String                 @unique
  qrCodeData             String?
  isActive               Boolean                @default(true)
  connectionId           String?
  createdAt              DateTime               @default(now())
  expiresAt              DateTime
  connectedAt            DateTime?
  deviceId               Int?
  response_tree_sessions response_tree_sessions @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([code])
  @@index([isActive])
}

model response_tree_sessions {
  id                         String                       @id
  treeId                     String
  userId                     String?
  deviceId                   String?
  currentNodeId              String?
  metadata                   Json?
  isComplete                 Boolean                      @default(false)
  startedAt                  DateTime                     @default(now())
  updatedAt                  DateTime
  completedAt                DateTime?
  endedAt                    DateTime?
  interfaceType              String?
  language                   String?
  lastActivityAt             DateTime?
  roomId                     String?
  sessionId                  String                       @unique
  response_tree_history      response_tree_history[]
  response_tree_mobile_links response_tree_mobile_links[]
  response_nodes             response_nodes?              @relation(fields: [currentNodeId], references: [id])
  response_trees             response_trees               @relation(fields: [treeId], references: [id], onDelete: Cascade)

  @@index([deviceId])
  @@index([isComplete])
  @@index([treeId])
  @@index([userId])
}

model response_tree_versions {
  id             String         @id
  treeId         String
  version        Int
  snapshot       Json
  createdAt      DateTime       @default(now())
  createdBy      String?
  data           Json?
  response_trees response_trees @relation(fields: [treeId], references: [id], onDelete: Cascade)

  @@unique([treeId, version])
}

model response_trees {
  id                     String                   @id
  tenantId               String
  name                   String
  description            String?
  isPublished            Boolean                  @default(false)
  publishedAt            DateTime?
  version                Int                      @default(1)
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  isActive               Boolean                  @default(true)
  deleted_at             DateTime?
  deleted_by             String?
  is_deleted             Boolean                  @default(false)
  response_nodes         response_nodes[]
  response_tree_sessions response_tree_sessions[]
  response_tree_versions response_tree_versions[]

  @@index([isPublished])
  @@index([is_deleted])
  @@index([tenantId])
}

model room_grades {
  id                   String   @id
  tenant_id            String
  code                 String
  name                 String
  description          String?
  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt
  grade_name_en        String?
  grade_level          Int?
  default_capacity     Int?
  max_capacity         Int?
  room_size_sqm        Decimal? @db.Decimal
  standard_amenities   Json?
  premium_amenities    Json?
  included_services    Json?
  member_only          Boolean? @default(false)
  min_stay_nights      Int?
  advance_booking_days Int?
  display_order        Int?
  is_active            Boolean? @default(true)
  is_public            Boolean? @default(true)
  pricing_category     String?

  @@unique([tenant_id, code])
  @@index([tenant_id])
  @@index([display_order], map: "idx_room_grades_display_order")
  @@index([is_active], map: "idx_room_grades_is_active")
  @@index([is_public], map: "idx_room_grades_is_public")
}

model schema_version {
  version      String   @id
  description  String
  rollback_sql String?
  applied_at   DateTime @default(now())
  applied_by   String?
}

model service_plan_restrictions {
  id                        String   @id
  service_type              String
  plan_type                 String
  plan_category             String
  max_users                 Int      @default(10)
  max_devices               Int      @default(5)
  max_monthly_orders        Int?
  enable_ai_concierge       Boolean?
  enable_multilingual       Boolean?
  max_rooms                 Int?
  enable_revenue_management Boolean?
  max_monthly_ai_requests   Int?
  enable_ai_crm             Boolean?
  monthly_price             Int      @default(9800)
  created_at                DateTime @default(now())
  updated_at                DateTime @default(now())

  @@unique([service_type, plan_type, plan_category], map: "service_plan_restrictions_service_type_plan_type_plan_category_")
}

model service_usage_statistics {
  id                   String   @id
  tenant_id            String
  service_type         String
  month                String
  active_users_count   Int      @default(0)
  active_devices_count Int      @default(0)
  usage_data           Json     @default("{}")
  created_at           DateTime @default(now())
  updated_at           DateTime @default(now())
  Tenant               Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, service_type, month])
}

model staff {
  id                                                              String                     @id
  email                                                           String                     @unique
  name                                                            String
  is_active                                                       Boolean                    @default(true)
  created_at                                                      DateTime                   @default(now())
  updated_at                                                      DateTime
  failed_login_count                                              Int                        @default(0)
  last_login_at                                                   DateTime?
  locked_until                                                    DateTime?
  password_hash                                                   String?
  deleted_at                                                      DateTime?
  deleted_by                                                      String?
  is_deleted                                                      Boolean                    @default(false)
  ai_operation_logs                                               ai_operation_logs[]
  auth_logs                                                       auth_logs[]
  billing_logs                                                    billing_logs[]
  comment_read_statuses                                           comment_read_statuses[]
  memo_access_logs                                                memo_access_logs[]
  memo_attachments_memo_attachments_created_byTostaff             memo_attachments[]         @relation("memo_attachments_created_byTostaff")
  memo_attachments_memo_attachments_deleted_byTostaff             memo_attachments[]         @relation("memo_attachments_deleted_byTostaff")
  memo_comments_memo_comments_author_idTostaff                    memo_comments[]            @relation("memo_comments_author_idTostaff")
  memo_comments_memo_comments_created_byTostaff                   memo_comments[]            @relation("memo_comments_created_byTostaff")
  memo_comments_memo_comments_deleted_byTostaff                   memo_comments[]            @relation("memo_comments_deleted_byTostaff")
  memo_comments_memo_comments_updated_byTostaff                   memo_comments[]            @relation("memo_comments_updated_byTostaff")
  memo_notifications_memo_notifications_created_byTostaff         memo_notifications[]       @relation("memo_notifications_created_byTostaff")
  memo_notifications_memo_notifications_recipient_staff_idTostaff memo_notifications[]       @relation("memo_notifications_recipient_staff_idTostaff")
  memo_read_statuses                                              memo_read_statuses[]
  memos_memos_archived_byTostaff                                  memos[]                    @relation("memos_archived_byTostaff")
  memos_memos_author_idTostaff                                    memos[]                    @relation("memos_author_idTostaff")
  memos_memos_created_byTostaff                                   memos[]                    @relation("memos_created_byTostaff")
  memos_memos_deleted_byTostaff                                   memos[]                    @relation("memos_deleted_byTostaff")
  memos_memos_updated_byTostaff                                   memos[]                    @relation("memos_updated_byTostaff")
  security_logs                                                   security_logs[]
  staff_invitations                                               staff_invitations[]
  staff_tenant_memberships                                        staff_tenant_memberships[]

  @@index([email])
  @@index([email], map: "Staff_email_idx")
  @@index([email], map: "idx_staff_email_new")
  @@index([is_active], map: "idx_staff_is_active")
  @@index([is_deleted], map: "idx_staff_is_deleted")
}

model system_event {
  id            String    @id
  tenant_id     String
  user_id       String?
  event_type    String
  source_system String
  target_system String
  entity_type   String
  entity_id     String
  action        String
  event_data    Json?
  created_at    DateTime  @default(now())
  processed_at  DateTime?
  status        String    @default("PENDING")

  @@index([created_at])
  @@index([event_type])
  @@index([status])
  @@index([tenant_id])
}

model tenant_access_logs {
  id            String   @id
  tenant_id     String
  user_id       String?
  action        String
  resource      String?
  ip_address    String?
  user_agent    String?
  created_at    DateTime @default(now())
  source_system String?

  @@index([created_at])
  @@index([tenant_id])
  @@index([user_id])
}

model tenant_services {
  id             String    @id
  tenant_id      String
  service_type   String
  plan_type      String
  is_active      Boolean   @default(true)
  activated_at   DateTime  @default(now())
  expires_at     DateTime?
  service_config Json      @default("{}")
  created_at     DateTime  @default(now())
  updated_at     DateTime  @default(now())
  Tenant         Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, service_type])
}

model checkin_sessions {
  id                String    @id @default(cuid())
  tenant_id         String
  session_number    String    @unique
  reservation_id    String?
  room_id           String
  guest_info        Json
  adults            Int       @default(1)
  children          Int       @default(0)
  check_in_at       DateTime
  check_out_at      DateTime?
  planned_check_out DateTime
  status            String    @default("ACTIVE")
  special_requests  String?
  notes             String?
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  orders            orders[]

  @@index([tenant_id])
  @@index([session_number])
  @@index([room_id])
  @@index([status])
  @@index([check_in_at])
}

model session_billings {
  id              String    @id @default(cuid())
  tenant_id       String
  session_id      String
  billing_number  String    @unique
  room_charges    Json
  service_charges Json
  taxes           Json
  discounts       Json
  subtotal_amount Int
  tax_amount      Int
  total_amount    Int
  paid_amount     Int       @default(0)
  status          String    @default("PENDING")
  payment_method  String?
  payment_date    DateTime?
  due_date        DateTime
  notes           String?
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt

  @@index([tenant_id])
  @@index([session_id])
  @@index([billing_number])
  @@index([status])
  @@index([due_date])
}

model Room {
  id          String    @id @default(cuid())
  tenantId    String
  roomNumber  String
  roomType    String
  floor       Int?
  status      String    @default("AVAILABLE")
  capacity    Int       @default(2)
  amenities   Json?
  notes       String?
  lastCleaned DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  isDeleted   Boolean   @default(false)
  deletedAt   DateTime?
  deletedBy   String?

  @@unique([tenantId, roomNumber])
  @@index([tenantId])
  @@index([status])
  @@index([roomType])
  @@index([floor])
  @@index([isDeleted])
  @@map("rooms")
}

model RoomMemo {
  id                String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  tenantId          String    @map("tenant_id")
  roomId            String    @map("room_id")
  category          String
  visibility        String    @default("public")
  visibleRoles      String[]  @default([]) @map("visible_roles")
  content           String
  status            String    @default("pending")
  priority          String    @default("normal")
  dueDate           DateTime? @map("due_date") @db.Timestamptz(6)
  createdByStaffId  String    @map("created_by_staff_id")
  assignedToStaffId String?   @map("assigned_to_staff_id")
  updatedByStaffId  String?   @map("updated_by_staff_id")
  isDeleted         Boolean   @default(false) @map("is_deleted")
  deletedAt         DateTime? @map("deleted_at") @db.Timestamptz(6)
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@index([tenantId, roomId, status], map: "idx_room_memos_tenant_room_status")
  @@index([assignedToStaffId, status], map: "idx_room_memos_assignee_status")
  @@map("room_memos")
}

model RoomMemoComment {
  id               String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  tenantId         String   @map("tenant_id")
  memoId           String   @map("memo_id")
  parentCommentId  String?  @map("parent_comment_id")
  content          String
  commentType      String   @default("comment") @map("comment_type")
  statusFrom       String?  @map("status_from")
  statusTo         String?  @map("status_to")
  createdByStaffId String   @map("created_by_staff_id")
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  @@index([tenantId, memoId, createdAt], map: "idx_memo_comments_memo_created")
  @@map("room_memo_comments")
}

model RoomMemoStatusLog {
  id               String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  tenantId         String   @map("tenant_id")
  memoId           String   @map("memo_id")
  statusFrom       String   @map("status_from")
  statusTo         String   @map("status_to")
  comment          String?
  changedByStaffId String   @map("changed_by_staff_id")
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  @@index([tenantId, memoId, createdAt], map: "idx_memo_status_memo_created")
  @@map("room_memo_status_logs")
}

model RoomMemoRead {
  id       String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  tenantId String   @map("tenant_id")
  memoId   String   @map("memo_id")
  staffId  String   @map("staff_id")
  readAt   DateTime @default(now()) @map("read_at") @db.Timestamptz(6)

  @@unique([tenantId, memoId, staffId])
  @@map("room_memo_reads")
}

model Transaction {
  id          String    @id @default(cuid())
  tenantId    String
  invoiceId   String?
  paymentId   String?
  type        String
  amount      Int
  taxAmount   Int       @default(0)
  totalAmount Int
  status      String    @default("PENDING")
  description String?
  reference   String?
  metadata    Json?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  createdBy   String?
  isDeleted   Boolean   @default(false)
  deletedAt   DateTime?
  deletedBy   String?
  payment     Payment?  @relation("TransactionPayment")
  invoice     Invoice?  @relation(fields: [invoiceId], references: [id])

  @@index([tenantId])
  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@index([isDeleted])
  @@map("transactions")
}

model Invoice {
  id             String        @id @default(cuid())
  tenantId       String
  invoiceNumber  String        @unique
  customerId     String?
  customerName   String
  customerEmail  String?
  billingAddress Json?
  items          Json
  subtotal       Int
  taxAmount      Int
  totalAmount    Int
  status         String        @default("DRAFT")
  dueDate        DateTime?
  issuedAt       DateTime?
  paidAt         DateTime?
  notes          String?
  metadata       Json?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  createdBy      String?
  isDeleted      Boolean       @default(false)
  deletedAt      DateTime?
  deletedBy      String?
  payments       Payment[]
  transactions   Transaction[]

  @@index([tenantId])
  @@index([status])
  @@index([createdAt])
  @@index([isDeleted])
  @@index([invoiceNumber])
  @@map("invoices")
}

model Payment {
  id            String       @id @default(cuid())
  tenantId      String
  transactionId String?      @unique
  paymentMethod String
  amount        Int
  status        String       @default("PENDING")
  reference     String?
  metadata      Json?
  processedAt   DateTime?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  createdBy     String?
  isDeleted     Boolean      @default(false)
  deletedAt     DateTime?
  deletedBy     String?
  invoiceId     String?
  invoice       Invoice?     @relation(fields: [invoiceId], references: [id])
  transaction   Transaction? @relation("TransactionPayment", fields: [transactionId], references: [id])

  @@index([tenantId])
  @@index([paymentMethod])
  @@index([status])
  @@index([createdAt])
  @@index([isDeleted])
  @@map("payments")
}

model ai_operation_logs {
  id                 String   @id
  tenant_id          String
  user_id            String?
  operation          String
  ai_function        String
  credit_amount      Int
  balance_before     Int
  balance_after      Int
  request_details    Json?
  response_details   Json?
  cost_calculation   Json?
  processing_time_ms Int?
  success            Boolean  @default(true)
  error_details      Json?
  created_at         DateTime @default(now()) @db.Timestamptz(6)
  Tenant             Tenant   @relation(fields: [tenant_id], references: [id])
  staff              staff?   @relation(fields: [user_id], references: [id])

  @@index([ai_function, created_at(sort: Desc)], map: "idx_ai_operation_logs_function_created")
  @@index([tenant_id, created_at(sort: Desc)], map: "idx_ai_operation_logs_tenant_created")
  @@index([user_id, created_at(sort: Desc)], map: "idx_ai_operation_logs_user_created")
}

model auth_logs {
  id             String   @id
  tenant_id      String
  user_id        String?
  action         String
  ip_address     String?  @db.Inet
  user_agent     String?
  session_id     String?
  success        Boolean
  failure_reason String?
  device_info    Json?
  location_info  Json?
  created_at     DateTime @default(now()) @db.Timestamptz(6)
  Tenant         Tenant   @relation(fields: [tenant_id], references: [id])
  staff          staff?   @relation(fields: [user_id], references: [id])

  @@index([success, created_at(sort: Desc)], map: "idx_auth_logs_failed")
  @@index([tenant_id, created_at(sort: Desc)], map: "idx_auth_logs_tenant_created")
  @@index([user_id, action, created_at(sort: Desc)], map: "idx_auth_logs_user_action_created")
}

model billing_logs {
  id                      String   @id
  tenant_id               String
  billing_period          String
  operation               String
  amount                  Decimal? @db.Decimal(10, 2)
  currency                String?  @default("JPY")
  calculation_details     Json?
  payment_method          String?
  payment_status          String?
  external_transaction_id String?
  invoice_number          String?
  error_details           Json?
  processed_by            String?
  created_at              DateTime @default(now()) @db.Timestamptz(6)
  staff                   staff?   @relation(fields: [processed_by], references: [id])
  Tenant                  Tenant   @relation(fields: [tenant_id], references: [id])

  @@index([external_transaction_id], map: "idx_billing_logs_external_id")
  @@index([operation, created_at(sort: Desc)], map: "idx_billing_logs_operation_created")
  @@index([tenant_id, billing_period], map: "idx_billing_logs_tenant_period")
}

model comment_read_statuses {
  id            String        @id @default(dbgenerated("gen_random_uuid()"))
  comment_id    String
  staff_id      String
  source_system String        @db.VarChar(10)
  is_read       Boolean       @default(false)
  read_at       DateTime?     @db.Timestamptz(6)
  read_count    Int           @default(0)
  created_at    DateTime      @default(now()) @db.Timestamptz(6)
  updated_at    DateTime      @default(now()) @db.Timestamptz(6)
  memo_comments memo_comments @relation(fields: [comment_id], references: [id], onDelete: Cascade)
  staff         staff         @relation(fields: [staff_id], references: [id], onDelete: Cascade)

  @@unique([comment_id, staff_id, source_system])
  @@index([comment_id, staff_id])
  @@index([staff_id, comment_id])
}

model device_access_logs {
  id            BigInt        @id @default(autoincrement())
  tenantId      String
  deviceId      Int?
  macAddress    String?
  ipAddress     String
  userAgent     String?
  pagePath      String
  authMethod    String
  authResult    String
  failureReason String?
  accessedAt    DateTime      @default(now())
  responseTime  Int?
  createdAt     DateTime      @default(now())
  device_rooms  device_rooms? @relation(fields: [deviceId], references: [id])

  @@index([accessedAt])
  @@index([authMethod])
  @@index([authResult])
  @@index([createdAt])
  @@index([deviceId])
  @@index([ipAddress])
  @@index([macAddress])
  @@index([tenantId])
}

model device_usage_logs {
  id                       String   @id
  tenant_id                String
  device_id                String?
  room_id                  String?
  event_type               String
  connection_quality       Int?
  session_duration_minutes Int?
  data_transferred_mb      Decimal? @db.Decimal(10, 2)
  error_count              Int?     @default(0)
  device_info              Json?
  network_info             Json?
  performance_metrics      Json?
  created_at               DateTime @default(now()) @db.Timestamptz(6)
  Tenant                   Tenant   @relation(fields: [tenant_id], references: [id])

  @@index([device_id, created_at(sort: Desc)], map: "idx_device_usage_logs_device_created")
  @@index([room_id, created_at(sort: Desc)], map: "idx_device_usage_logs_room_created")
  @@index([tenant_id, created_at(sort: Desc)], map: "idx_device_usage_logs_tenant_created")
}

model memo_access_logs {
  id            String   @id @default(dbgenerated("gen_random_uuid()"))
  memo_id       String
  staff_id      String
  source_system String   @db.VarChar(10)
  action        String   @db.VarChar(20)
  ip_address    String?  @db.Inet
  user_agent    String?
  session_id    String?  @db.VarChar(100)
  details       Json     @default("{}")
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  memos         memos    @relation(fields: [memo_id], references: [id], onDelete: Cascade)
  staff         staff    @relation(fields: [staff_id], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([created_at(sort: Desc)])
  @@index([memo_id])
  @@index([memo_id, staff_id, created_at(sort: Desc)])
  @@index([staff_id, action, created_at(sort: Desc)])
  @@index([staff_id])
}

model memo_attachments {
  id                                       String         @id @default(dbgenerated("gen_random_uuid()"))
  memo_id                                  String
  comment_id                               String?
  original_filename                        String
  stored_filename                          String
  file_path                                String
  file_size                                BigInt
  mime_type                                String         @db.VarChar(100)
  file_hash                                String         @db.VarChar(64)
  is_image                                 Boolean        @default(false)
  image_width                              Int?
  image_height                             Int?
  is_deleted                               Boolean        @default(false)
  created_at                               DateTime       @default(now()) @db.Timestamptz(6)
  deleted_at                               DateTime?      @db.Timestamptz(6)
  created_by                               String
  deleted_by                               String?
  memo_comments                            memo_comments? @relation(fields: [comment_id], references: [id], onDelete: Cascade)
  staff_memo_attachments_created_byTostaff staff          @relation("memo_attachments_created_byTostaff", fields: [created_by], references: [id])
  staff_memo_attachments_deleted_byTostaff staff?         @relation("memo_attachments_deleted_byTostaff", fields: [deleted_by], references: [id])
  memos                                    memos          @relation(fields: [memo_id], references: [id], onDelete: Cascade)

  @@index([comment_id])
  @@index([created_at(sort: Desc)])
  @@index([memo_id])
}

model memo_comments {
  id                                    String                  @id @default(dbgenerated("gen_random_uuid()"))
  memo_id                               String
  parent_comment_id                     String?
  author_id                             String
  source_system                         String                  @db.VarChar(10)
  content                               String
  is_edited                             Boolean                 @default(false)
  is_deleted                            Boolean                 @default(false)
  reply_count                           Int                     @default(0)
  created_at                            DateTime                @default(now()) @db.Timestamptz(6)
  updated_at                            DateTime                @default(now()) @db.Timestamptz(6)
  deleted_at                            DateTime?               @db.Timestamptz(6)
  created_by                            String
  updated_by                            String?
  deleted_by                            String?
  comment_read_statuses                 comment_read_statuses[]
  memo_attachments                      memo_attachments[]
  staff_memo_comments_author_idTostaff  staff                   @relation("memo_comments_author_idTostaff", fields: [author_id], references: [id])
  staff_memo_comments_created_byTostaff staff                   @relation("memo_comments_created_byTostaff", fields: [created_by], references: [id])
  staff_memo_comments_deleted_byTostaff staff?                  @relation("memo_comments_deleted_byTostaff", fields: [deleted_by], references: [id])
  memos                                 memos                   @relation(fields: [memo_id], references: [id], onDelete: Cascade)
  memo_comments                         memo_comments?          @relation("memo_commentsTomemo_comments", fields: [parent_comment_id], references: [id], onDelete: Cascade)
  other_memo_comments                   memo_comments[]         @relation("memo_commentsTomemo_comments")
  staff_memo_comments_updated_byTostaff staff?                  @relation("memo_comments_updated_byTostaff", fields: [updated_by], references: [id])
  memo_notifications                    memo_notifications[]

  @@index([author_id])
  @@index([created_at(sort: Desc)])
  @@index([memo_id, created_at(sort: Desc)])
  @@index([memo_id])
  @@index([parent_comment_id])
}

model memo_notifications {
  id                                                 String         @id @default(dbgenerated("gen_random_uuid()"))
  recipient_staff_id                                 String
  memo_id                                            String
  comment_id                                         String?
  notification_type                                  String         @db.VarChar(30)
  title                                              String
  message                                            String
  is_read                                            Boolean        @default(false)
  is_sent                                            Boolean        @default(false)
  send_email                                         Boolean        @default(false)
  send_push                                          Boolean        @default(false)
  send_websocket                                     Boolean        @default(true)
  created_at                                         DateTime       @default(now()) @db.Timestamptz(6)
  read_at                                            DateTime?      @db.Timestamptz(6)
  sent_at                                            DateTime?      @db.Timestamptz(6)
  created_by                                         String
  memo_comments                                      memo_comments? @relation(fields: [comment_id], references: [id], onDelete: Cascade)
  staff_memo_notifications_created_byTostaff         staff          @relation("memo_notifications_created_byTostaff", fields: [created_by], references: [id])
  memos                                              memos          @relation(fields: [memo_id], references: [id], onDelete: Cascade)
  staff_memo_notifications_recipient_staff_idTostaff staff          @relation("memo_notifications_recipient_staff_idTostaff", fields: [recipient_staff_id], references: [id], onDelete: Cascade)

  @@index([created_at(sort: Desc)])
  @@index([is_sent])
  @@index([memo_id])
  @@index([recipient_staff_id])
}

model memo_read_statuses {
  id                      String    @id @default(dbgenerated("gen_random_uuid()"))
  memo_id                 String
  staff_id                String
  source_system           String    @db.VarChar(10)
  is_read                 Boolean   @default(false)
  read_at                 DateTime? @db.Timestamptz(6)
  last_content_hash       String?   @db.VarChar(64)
  last_read_version       Int       @default(1)
  read_count              Int       @default(0)
  total_read_time_seconds Int       @default(0)
  created_at              DateTime  @default(now()) @db.Timestamptz(6)
  updated_at              DateTime  @default(now()) @db.Timestamptz(6)
  memos                   memos     @relation(fields: [memo_id], references: [id], onDelete: Cascade)
  staff                   staff     @relation(fields: [staff_id], references: [id], onDelete: Cascade)

  @@unique([memo_id, staff_id, source_system])
  @@index([memo_id, staff_id])
  @@index([read_at(sort: Desc)])
  @@index([staff_id, memo_id])
  @@index([staff_id, source_system])
}

model memos {
  id                             String               @id @default(dbgenerated("gen_random_uuid()"))
  tenant_id                      String
  title                          String
  content                        String
  author_id                      String
  source_system                  String               @db.VarChar(10)
  tags                           Json                 @default("[]")
  priority                       String               @default("medium") @db.VarChar(10)
  category                       String?              @db.VarChar(50)
  is_pinned                      Boolean              @default(false)
  is_archived                    Boolean              @default(false)
  is_deleted                     Boolean              @default(false)
  view_count                     Int                  @default(0)
  comment_count                  Int                  @default(0)
  attachment_count               Int                  @default(0)
  created_at                     DateTime             @default(now()) @db.Timestamptz(6)
  updated_at                     DateTime             @default(now()) @db.Timestamptz(6)
  archived_at                    DateTime?            @db.Timestamptz(6)
  deleted_at                     DateTime?            @db.Timestamptz(6)
  created_by                     String
  updated_by                     String?
  archived_by                    String?
  deleted_by                     String?
  memo_access_logs               memo_access_logs[]
  memo_attachments               memo_attachments[]
  memo_comments                  memo_comments[]
  memo_notifications             memo_notifications[]
  memo_read_statuses             memo_read_statuses[]
  staff_memos_archived_byTostaff staff?               @relation("memos_archived_byTostaff", fields: [archived_by], references: [id])
  staff_memos_author_idTostaff   staff                @relation("memos_author_idTostaff", fields: [author_id], references: [id])
  staff_memos_created_byTostaff  staff                @relation("memos_created_byTostaff", fields: [created_by], references: [id])
  staff_memos_deleted_byTostaff  staff?               @relation("memos_deleted_byTostaff", fields: [deleted_by], references: [id])
  staff_memos_updated_byTostaff  staff?               @relation("memos_updated_byTostaff", fields: [updated_by], references: [id])

  @@index([author_id])
  @@index([category])
  @@index([created_at(sort: Desc)])
  @@index([is_pinned])
  @@index([priority])
  @@index([source_system])
  @@index([tenant_id])
  @@index([tenant_id, priority, created_at(sort: Desc)])
  @@index([tenant_id, source_system, created_at(sort: Desc)])
  @@index([updated_at(sort: Desc)])
}

model menu_categories {
  id                    Int               @id @default(autoincrement())
  tenant_id             String
  name_ja               String
  name_en               String?
  description_ja        String?
  description_en        String?
  parent_id             Int?
  sort_order            Int               @default(0)
  is_active             Boolean           @default(true)
  created_at            DateTime          @default(now())
  updated_at            DateTime
  is_deleted            Boolean           @default(false)
  deleted_at            DateTime?
  deleted_by            String?
  menu_categories       menu_categories?  @relation("menu_categoriesTomenu_categories", fields: [parent_id], references: [id])
  other_menu_categories menu_categories[] @relation("menu_categoriesTomenu_categories")
  menu_items            menu_items[]

  @@index([tenant_id, is_active], map: "idx_menu_categories_is_active")
  @@index([is_deleted], map: "idx_menu_categories_is_deleted")
  @@index([tenant_id, parent_id], map: "idx_menu_categories_parent_id")
  @@index([tenant_id], map: "idx_menu_categories_tenant_id")
}

model menu_items {
  id                  Int              @id @default(autoincrement())
  tenant_id           String
  name_ja             String
  name_en             String?
  description_ja      String?
  description_en      String?
  price               Int
  cost                Int              @default(0)
  category_id         Int?
  image_url           String?
  is_available        Boolean          @default(true)
  is_featured         Boolean          @default(false)
  is_hidden           Boolean          @default(false)
  display_order       Int              @default(0)
  start_time          DateTime?        @db.Time(6)
  end_time            DateTime?        @db.Time(6)
  age_restricted      Boolean          @default(false)
  stock_available     Boolean          @default(true)
  stock_quantity      Int?
  low_stock_threshold Int              @default(5)
  tags                Json             @default("[]")
  images              Json             @default("[]")
  nutritional_info    Json             @default("{}")
  allergens           Json             @default("[]")
  created_at          DateTime         @default(now())
  updated_at          DateTime
  is_deleted          Boolean          @default(false)
  deleted_at          DateTime?
  deleted_by          String?
  menu_categories     menu_categories? @relation(fields: [category_id], references: [id])

  @@index([tenant_id, is_available], map: "idx_menu_items_available")
  @@index([tenant_id, category_id], map: "idx_menu_items_category_id")
  @@index([tenant_id, is_featured], map: "idx_menu_items_featured")
  @@index([is_deleted], map: "idx_menu_items_is_deleted")
  @@index([tenant_id], map: "idx_menu_items_tenant_id")
}

model order_items {
  id          Int       @id @default(autoincrement())
  tenantId    String
  orderId     Int
  menuItemId  Int
  name        String
  price       Int
  quantity    Int
  status      String    @default("pending")
  notes       String?
  deliveredAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  deleted_at  DateTime?
  deleted_by  String?
  is_deleted  Boolean   @default(false)
  orders      orders    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([is_deleted])
  @@index([menuItemId])
  @@index([orderId])
  @@index([status])
  @@index([tenantId])
}

model orders {
  id               Int               @id @default(autoincrement())
  tenantId         String
  roomId           String
  placeId          Int?
  status           String            @default("received")
  items            Json
  total            Int
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  paidAt           DateTime?
  isDeleted        Boolean           @default(false)
  deletedAt        DateTime?
  sessionId        String?
  uuid             String?           @unique
  order_items      order_items[]
  checkin_sessions checkin_sessions? @relation(fields: [sessionId], references: [id])

  @@index([createdAt])
  @@index([isDeleted, paidAt])
  @@index([sessionId])
  @@index([status])
  @@index([tenantId])
}

model permissions {
  id               String             @id
  code             String             @unique
  name             String
  description      String?
  category         String
  is_active        Boolean            @default(true)
  created_at       DateTime           @default(now())
  updated_at       DateTime
  role_permissions role_permissions[]

  @@index([category], map: "idx_permissions_category")
  @@index([code], map: "idx_permissions_code")
  @@index([is_active], map: "idx_permissions_is_active")
}

model role_permissions {
  id            String      @id
  role_id       String
  permission_id String
  created_at    DateTime    @default(now())
  created_by    String?
  permissions   permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade)
  roles         roles       @relation(fields: [role_id], references: [id], onDelete: Cascade)

  @@unique([role_id, permission_id], map: "unq_role_permissions")
  @@index([permission_id], map: "idx_role_permissions_permission_id")
  @@index([role_id], map: "idx_role_permissions_role_id")
}

model role_templates {
  id               String   @id
  business_type    String
  name             String
  description      String?
  roles_definition Json
  is_active        Boolean  @default(true)
  is_system        Boolean  @default(false)
  created_at       DateTime @default(now())
  updated_at       DateTime
  created_by       String?
  updated_by       String?

  @@unique([business_type, name], map: "unq_role_templates_business_type_name")
  @@index([business_type], map: "idx_role_templates_business_type")
  @@index([is_active], map: "idx_role_templates_is_active")
  @@index([is_system], map: "idx_role_templates_is_system")
}

model roles {
  id                       String                     @id
  tenant_id                String
  name                     String
  description              String?
  sort_order               Int                        @default(0)
  is_active                Boolean                    @default(true)
  is_default               Boolean                    @default(false)
  created_at               DateTime                   @default(now())
  updated_at               DateTime
  created_by               String?
  updated_by               String?
  role_permissions         role_permissions[]
  staff_invitations        staff_invitations[]
  staff_tenant_memberships staff_tenant_memberships[]

  @@unique([tenant_id, name], map: "unq_roles_tenant_id_name")
  @@index([is_active], map: "idx_roles_is_active")
  @@index([is_default], map: "idx_roles_is_default")
  @@index([sort_order], map: "idx_roles_sort_order")
  @@index([tenant_id], map: "idx_roles_tenant_id")
}

model security_logs {
  id               String   @id
  tenant_id        String
  user_id          String?
  event_type       String
  severity         String
  description      String
  ip_address       String?  @db.Inet
  user_agent       String?
  request_details  Json?
  response_details Json?
  detection_method String?
  action_taken     String?
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  Tenant           Tenant   @relation(fields: [tenant_id], references: [id])
  staff            staff?   @relation(fields: [user_id], references: [id])

  @@index([event_type, created_at(sort: Desc)], map: "idx_security_logs_event_created")
  @@index([ip_address, created_at(sort: Desc)], map: "idx_security_logs_ip_created")
  @@index([severity, created_at(sort: Desc)], map: "idx_security_logs_severity_created")
  @@index([tenant_id, created_at(sort: Desc)], map: "idx_security_logs_tenant_created")
}

model staff_invitations {
  id          String    @id
  tenant_id   String
  email       String
  role_id     String
  invited_by  String
  token       String    @unique
  status      String    @default("pending")
  expires_at  DateTime
  accepted_at DateTime?
  created_at  DateTime  @default(now())
  updated_at  DateTime
  staff       staff     @relation(fields: [invited_by], references: [id])
  roles       roles     @relation(fields: [role_id], references: [id])
  Tenant      Tenant    @relation(fields: [tenant_id], references: [id])

  @@index([email], map: "idx_staff_invitations_email")
  @@index([expires_at], map: "idx_staff_invitations_expires_at")
  @@index([status], map: "idx_staff_invitations_status")
  @@index([tenant_id, email, status], map: "idx_staff_invitations_tenant_email_status")
  @@index([tenant_id], map: "idx_staff_invitations_tenant_id")
  @@index([token], map: "idx_staff_invitations_token")
}

model staff_tenant_memberships {
  id                 String   @id
  staff_id           String
  tenant_id          String
  is_active          Boolean  @default(true)
  is_primary         Boolean  @default(false)
  joined_at          DateTime @default(now())
  created_at         DateTime @default(now())
  updated_at         DateTime
  role_id            String
  custom_permissions Json     @default("[]")
  roles              roles    @relation(fields: [role_id], references: [id])
  staff              staff    @relation(fields: [staff_id], references: [id], onDelete: Cascade)
  Tenant             Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([staff_id, tenant_id], map: "uniq_staff_tenant")
  @@index([is_active], map: "idx_memberships_is_active")
  @@index([is_primary], map: "idx_memberships_is_primary")
  @@index([role_id], map: "idx_memberships_role_id")
  @@index([staff_id], map: "idx_memberships_staff_id")
  @@index([tenant_id], map: "idx_memberships_tenant_id")
}

model unified_media {
  id                  String    @id
  tenant_id           String
  original_filename   String
  stored_filename     String
  file_path           String
  file_size           BigInt
  mime_type           String
  width               Int?
  height              Int?
  format              String?
  source_system       String
  entity_type         String
  entity_id           String
  title               String?
  description         String?
  display_order       Int       @default(1)
  is_primary          Boolean   @default(false)
  is_active           Boolean   @default(true)
  is_display_in_slide Boolean   @default(true)
  slide_order         Int       @default(0)
  is_ai_enhanced      Boolean   @default(false)
  enhancement_data    Json?
  quality_score       Decimal?
  created_at          DateTime  @default(now())
  updated_at          DateTime
  deleted_at          DateTime?

  @@index([source_system, entity_type, is_active])
  @@index([tenant_id, entity_type, entity_id, is_display_in_slide, slide_order])
  @@index([tenant_id, entity_type, entity_id, is_primary])
  @@index([tenant_id, source_system, entity_type, entity_id])
}

enum AdminLevel {
  chainadmin
  groupadmin
  superadmin
}

enum CampaignCtaType {
  NONE
  LINK
  BUTTON
  COUPON
}

enum CampaignDisplayType {
  BANNER
  POPUP
  NOTIFICATION
  FEATURED
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  PAUSED
  ENDED
  SCHEDULED
}
